@model shoppingcartwebsite.ViewModels.ProductsViewModel

@{
    Layout = "_Layout";
}


@section Scripts{
    <script>
        $(document).ready(function () {
            $(".btn-favorite").on("click", function () {
                var id = $(this).attr("data-product-id");
                var url = '@Url.Action("UpdateFavoriteProduct", "Account")' + '/' + id;
                $.ajax({
                    type: 'GET',
                    url: url,
                    contentType: false,
                    processData: false,
                    cache: false,
                    success: function (response) {
                        const elem = document.getElementById('link-favorite-' + id);
                        const classAttr = elem.getAttribute('class');

                        if (classAttr === 'btn btn-light btn-favorite') {
                            elem.setAttribute("class", "btn btn-danger btn-favorite");
                        } else {
                            elem.setAttribute("class", "btn btn-light btn-favorite");
                        }
                    }
                });
            });
        });
    </script>
}


   

@{
	int groupingsNewProducts = 3;
	var groupedNewProducts = Model.Products
			.Select((x, i) =>
		new
		{
			x,
			i = i / groupingsNewProducts
		})
			.GroupBy(x => x.i, x => x.x);
}


<!-- SECTION -->
<div class="section">
	<!-- container -->
	<div class="container">
		 <h3 class="personal-data__data-title">@Model.Title</h3>
		<!-- row -->
		<div class="row">

			
			<!-- Products tab & slick -->
			<div class="col-md-12">
				<div class="row">
					<div class="products-tabs">
						<!-- tab -->
						<div id="tab1" class="tab-pane active">
							<div class="products-slick" data-nav="#slick-nav-1">

								<!-- product -->
								
								@foreach (var items in groupedNewProducts)
								{

									@foreach (var item in items)
									{
										<div class="product">
											<div class="product-img">
												<img src="@item.PathToImage" alt="">
												@{
													if (item.Discount != 0)
													{
														<div class="product-label">
															<span class="sale">@item.Discount %</span>

														</div>
													}

												}
											</div>
											<div class="product-body">

												@*<p class="product-category">Category</p>*@
												<h3 class="product-name"><a href="#">@item.Name</a></h3>
												@{
													if (item.Discount == 0)
													{
														<h4 class="product-price">
															@item.Price
														</h4>
													}
													else
													{
														<h4 class="product-price">
															@(item.Price * (100 - item.Discount) / 100)
															<del class="product-old-price">@item.Price</del>
														</h4>

													}
												}
											
												@{
													if (Model.Client != null)
													{
														<div class="product-btns">
															@{
																var product = Model.Client?.FavoriteProducts.FirstOrDefault(x => x.Id == item.Id);
																if (product == null)
																{

																	<a asp-action="Details" class="quick-view" asp-controller="Product" asp-route-id="@item.Id"><i class="fa fa-eye"></i></a>

																	<a id="link-favorite-@item.Id" href="javascript:void(0)" data-product-id="@item.Id" class="btn btn-light btn-favorite">
																		♥
																	</a>

																}
																else
																{
																	<button class="add-to-wishlist" id="link-favorite-@item.Id" href="javascript:void(0)" data-product-id="@item.Id"><i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span></button>
																}
															}
														</div>
													}
													else
													{
														<div class="product-btns">

															<a asp-action="Details" class="quick-view" asp-controller="Product" asp-route-id="@item.Id"><i class="fa fa-eye"></i></a>


															<a asp-action="Authorization" asp-controller="Account" class="add-to-wishlist">
																<i class="fa fa-heart-o"></i>
															</a>
														</div>
													}
												}

											</div>


											<div class="add-to-cart">
												<a asp-area="" asp-route-id="@item.Id" asp-controller="Basket" asp-action="AddProductInBasket">
													<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
												</a>

											</div>
										</div>
									}
								}
								<!-- /product -->
							</div>
							<div id="slick-nav-1" class="products-slick-nav"></div>
						</div>
						<!-- /tab -->
					</div>
				</div>
			</div>
			<!-- Products tab & slick -->
		</div>
		<!-- /row -->
	</div>
	<!-- /container -->
</div>
<!-- /SECTION -->



<!-- FOOTER -->
<footer id="footer">
	<!-- top footer -->
	<div class="section">
		<!-- container -->
		<div class="container">
			<!-- row -->
			<div class="row">
				<div class="col-md-3 col-xs-6">
					<div class="footer">
						<h3 class="footer-title">About Us</h3>
						<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut.</p>
						<ul class="footer-links">
							<li><a href="#"><i class="fa fa-map-marker"></i>1734 Stonecoal Road</a></li>
							<li><a href="#"><i class="fa fa-phone"></i>+021-95-51-84</a></li>
							<li><a href="#"><i class="fa fa-envelope-o"></i>email@email.com</a></li>
						</ul>
					</div>
				</div>

				<div class="col-md-3 col-xs-6">
					<div class="footer">
						<h3 class="footer-title">Categories</h3>
						<ul class="footer-links">
							<li><a href="#">Hot deals</a></li>
							<li><a href="#">Laptops</a></li>
							<li><a href="#">Smartphones</a></li>
							<li><a href="#">Cameras</a></li>
							<li><a href="#">Accessories</a></li>
						</ul>
					</div>
				</div>

				<div class="clearfix visible-xs"></div>

				<div class="col-md-3 col-xs-6">
					<div class="footer">
						<h3 class="footer-title">Information</h3>
						<ul class="footer-links">
							<li><a href="#">About Us</a></li>
							<li><a href="#">Contact Us</a></li>
							<li><a href="#">Privacy Policy</a></li>
							<li><a href="#">Orders and Returns</a></li>
							<li><a href="#">Terms & Conditions</a></li>
						</ul>
					</div>
				</div>

				<div class="col-md-3 col-xs-6">
					<div class="footer">
						<h3 class="footer-title">Service</h3>
						<ul class="footer-links">
							<li><a href="#">My Account</a></li>
							<li><a href="#">View Cart</a></li>
							<li><a href="#">Wishlist</a></li>
							<li><a href="#">Track My Order</a></li>
							<li><a href="#">Help</a></li>
						</ul>
					</div>
				</div>
			</div>
			<!-- /row -->
		</div>
		<!-- /container -->
	</div>
	<!-- /top footer -->
	<!-- bottom footer -->
	<div id="bottom-footer" class="section">
		<div class="container">
			<!-- row -->
			<div class="row">
				<div class="col-md-12 text-center">
					<ul class="footer-payments">
						<li><a href="#"><i class="fa fa-cc-visa"></i></a></li>
						<li><a href="#"><i class="fa fa-credit-card"></i></a></li>
						<li><a href="#"><i class="fa fa-cc-paypal"></i></a></li>
						<li><a href="#"><i class="fa fa-cc-mastercard"></i></a></li>
						<li><a href="#"><i class="fa fa-cc-discover"></i></a></li>
						<li><a href="#"><i class="fa fa-cc-amex"></i></a></li>
					</ul>
					<span class="copyright">
						<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
						Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
						<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
					</span>
				</div>
			</div>
			<!-- /row -->
		</div>
		<!-- /container -->
	</div>
	<!-- /bottom footer -->
</footer>
<!-- /FOOTER -->
